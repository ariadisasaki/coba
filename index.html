<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>

<video id="video" controls autoplay muted style="width:800px"></video>

<script>
const video = document.getElementById("video");

async function start(){

  const res = await fetch(
    "https://mantosecret.ariadishut.workers.dev/token?id=cnn",
    { cache: "no-store" }
  );

  const data = await res.json();
  console.log("TOKEN:", data);

  const url = data.url;
  console.log("URL:", url);

  if(Hls.isSupported()){
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, function () {
      video.play();
    });

    hls.on(Hls.Events.ERROR, function (event, data) {
      console.error("HLS ERROR:", data);
    });

  } else {
    video.src = url;
  }
}

start();
</script>

</body>
</html>
