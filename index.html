<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MANTO TV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{
  margin:0;
  background:#063b2e;
  font-family:Arial;
  color:white;
}

header{
  background:#0d5c46;
  padding:15px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}

.container{
  padding:10px;
}

video{
  width:100%;
  border-radius:10px;
  background:black;
}

.channel{
  background:#0d5c46;
  padding:15px;
  margin-top:10px;
  border-radius:10px;
  cursor:pointer;
  text-align:center;
  font-weight:bold;
}

.channel:hover{
  background:#19a974;
}
</style>
</head>
<body>

<header>MANTO TV</header>

<div class="container">

<video id="player" controls autoplay></video>

<div class="channel" onclick="startChannel('rmtv')">REAL MADRID TV</div>
<div class="channel" onclick="startChannel('cnn')">CNN INDONESIA</div>
<div class="channel" onclick="startChannel('beritasatu')">BERITA SATU</div>

</div>

<script>
const SECRET = "MANTO_TV_SECRET_2026";
const WORKER_BASE = "https://mantosecret.ariadishut.workers.dev/live/";

async function generateSignature(id, exp){

  const data = id + exp + SECRET; // WAJIB SAMA DENGAN WORKER

  const encoder = new TextEncoder();
  const hashBuffer =
    await crypto.subtle.digest("SHA-256", encoder.encode(data));

  return Array.from(new Uint8Array(hashBuffer))
    .map(b => b.toString(16).padStart(2,"0"))
    .join("");
}

async function startChannel(id){

  const video = document.getElementById("player");

  const exp = Date.now() + (60 * 60 * 1000); // 1 jam
  const sig = await generateSignature(id, exp);

  const proxyUrl = `${WORKER_BASE}${id}?exp=${exp}&sig=${sig}`;

  console.log("Stream URL:", proxyUrl);

  if (Hls.isSupported()) {

    if (window.hls) {
      window.hls.destroy();
    }

    const hls = new Hls();
    window.hls = hls;

    hls.loadSource(proxyUrl);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, function () {
      video.play();
    });

  } else if (video.canPlayType("application/vnd.apple.mpegurl")) {

    video.src = proxyUrl;
    video.addEventListener("loadedmetadata", function () {
      video.play();
    });

  } else {
    alert("Browser tidak support HLS");
  }
}
</script>

</body>
</html>
