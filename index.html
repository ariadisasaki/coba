<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MANTO TV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:#061b0f;color:#eafff3}

.theme-toggle{
  position:fixed;top:8px;right:10px;z-index:1600;
  padding:7px 14px;border-radius:20px;border:0;cursor:pointer;
  background:#0b3d1e;color:#eafff3;font-size:16px;transition:.25s ease;
}
.theme-toggle:hover{
  background:#00d86f;transform:scale(1.1);
  box-shadow:0 0 12px rgba(0,255,140,.7);
}

.ticker{
  position:fixed;top:0;width:100%;height:48px;
  background:#0b3d1e;overflow:hidden;z-index:1000;cursor:pointer;
}
.ticker span{
  display:inline-block;padding:14px 0;
  white-space:nowrap;min-width:100vw;
  animation:ticker 40s linear infinite;
}
.ticker.paused span{animation-play-state:paused;}
@keyframes ticker{
  from{transform:translateX(100vw)}
  to{transform:translateX(-100%)}
}
.ticker-link{color:#6bff95;font-weight:bold;text-decoration:none;}

.overlay{padding-top:48px}
.container{
  display:flex;gap:12px;
  height:calc(100vh - 48px);padding:10px;
}

.player{flex:3}
.player-wrapper{
  position:relative;width:100%;height:100%;
  background:#022b17;border-radius:10px;
  box-shadow:0 0 18px rgba(0,255,128,.25);
}
video{
  width:100%;height:100%;
  object-fit:cover;background:#000;
}

.fullscreen-btn{
  position:absolute;bottom:14px;right:14px;
  background:rgba(0,120,60,.85);color:#fff;
  border:0;padding:12px 18px;border-radius:10px;
  cursor:pointer;font-size:26px;transition:.25s ease;
}
.fullscreen-btn:hover{
  background:#00ff8a;color:#003018;
  transform:scale(1.12);
  box-shadow:0 0 14px rgba(0,255,140,.9);
}

.clock{
  position:absolute;top:10px;right:14px;
  background:rgba(0,0,0,.6);
  padding:8px 14px;font-size:26px;
  border-radius:8px;color:#fff;font-weight:bold;
}

.channel-list{
  flex:1;background:#08311c;
  border-radius:8px;padding:8px;overflow-y:auto;
}
.channel{
  padding:12px;margin-bottom:8px;
  background:#0f4d2a;border-radius:6px;
  text-align:center;cursor:pointer;
  color:#eafff3;transition:.2s ease;
}
.channel:hover{
  background:#00d86f;color:#003018;
  transform:scale(1.04);
}
.channel.active{
  background:#2cff9a;color:#002412;font-weight:bold;
}

@media(max-width:900px){
  .container{flex-direction:column;height:auto}
  .player{position:sticky;top:48px}
  .player-wrapper{aspect-ratio:16/9;height:auto}
}

</style>
</head>

<body>

<button id="themeToggle" class="theme-toggle">ðŸŒ™</button>

<div class="ticker" id="ticker">
  <span>
    Selamat datang di MANTO TV, jika ada keluhan hubungi
    <a class="ticker-link" href="https://www.facebook.com/share/1C8bjd7Xoh" target="_blank">
      Ariadi Forester
    </a>
  </span>
</div>

<div class="overlay">
<div class="container">

<div class="player">
<div class="player-wrapper" id="playerBox">
  <video id="video" muted autoplay playsinline controls></video>
  <div class="clock" id="clock"></div>
  <button class="fullscreen-btn" onclick="toggleFullscreen()">â›¶</button>
</div>
</div>

<div class="channel-list">
  <div class="channel active" data-id="rmtv">REAL MADRID TV</div>
  <div class="channel" data-id="bsatu">BERITA SATU ENGLISH</div>
  <div class="channel" data-id="cnn">CNN INDONESIA</div>
</div>

</div>
</div>

<script>
const video = document.getElementById("video");
const channels = document.querySelectorAll(".channel");
const ticker = document.getElementById("ticker");

let hls = null;

/* ===== AMBIL TOKEN DARI WORKER ===== */
async function getStreamUrl(channelId){
  const res = await fetch(
    `https://mantosecret.ariadishut.workers.dev/token?id=${channelId}`,
    { cache: "no-store" }   // penting supaya tidak expired cache
  );
  const data = await res.json();
  console.log("TOKEN:", data);
  return data.url;
}

/* ===== PLAY CHANNEL ===== */
async function playTV(channelId){

  try{

    // Hancurkan player lama
    if(hls){
      hls.destroy();
      hls = null;
    }

    // Reset video total
    video.pause();
    video.removeAttribute("src");
    video.load();

    const streamUrl = await getStreamUrl(channelId);
    console.log("STREAM URL:", streamUrl);

    if(Hls.isSupported()){

      hls = new Hls({
        enableWorker: true,
        lowLatencyMode: false
      });

      hls.loadSource(streamUrl);
      hls.attachMedia(video);

      hls.on(Hls.Events.MANIFEST_PARSED, function () {
        console.log("MANIFEST LOADED");
        video.play().catch(err => console.log("PLAY BLOCKED:", err));
      });

      hls.on(Hls.Events.ERROR, function (event, data) {
        console.error("HLS ERROR:", data);
      });

    } else if(video.canPlayType('application/vnd.apple.mpegurl')) {

      video.src = streamUrl;
      video.addEventListener("loadedmetadata", () => {
        video.play().catch(err => console.log("PLAY BLOCKED:", err));
      });

    }

  }catch(err){
    console.error("PLAY ERROR:", err);
  }
}

/* ===== CLICK EVENT ===== */
channels.forEach(ch=>{
  ch.addEventListener("click", ()=>{
    channels.forEach(c=>c.classList.remove("active"));
    ch.classList.add("active");
    playTV(ch.dataset.id);
  });
});

/* AUTO PLAY PERTAMA */
playTV(channels[0].dataset.id);

/* FULLSCREEN */
function toggleFullscreen(){
  const playerBox = document.getElementById("playerBox");
  if(!document.fullscreenElement){
    playerBox.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
}

/* CLOCK */
setInterval(()=>{
  document.getElementById("clock")
    .textContent = new Date().toLocaleTimeString("id-ID");
},1000);

/* TICKER PAUSE */
ticker.onclick = () => {
  ticker.classList.toggle("paused");
};
</script>

</body>
</html>
